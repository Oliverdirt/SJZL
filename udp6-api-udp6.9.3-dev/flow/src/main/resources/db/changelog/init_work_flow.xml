<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <property name="autoIncrement" value="false" dbms="oracle"/>
    <property name="autoIncrement" value="false" dbms="mysql,mssql,h2,postgresql,sybase"/>
    <property name="intType" value="bigint" dbms="postgresql"/>
    <property name="intType" value="int(11)" dbms="mysql,mssql,h2,oracle,sybase,maridb"/>
    <property name="longType" value="bigint" dbms="mysql,postgresql"/>
    <property name="longType" value="bigint" dbms="mssql,h2,oracle,sybase,maridb"/>

    <changeSet id="FLOW-20220805-001" author="jshx">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cscp_flow_process_def_ext"/>
            </not>
        </preConditions>
        <createTable tableName="cscp_flow_process_def_ext" remarks="流程定义扩展表">
            <column name="id" type="number" remarks="编号">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="process_definition_id" type="varchar(100)"  remarks="流程定义的编号">
                <constraints nullable="true" />
            </column>
            <column name="model_id" type="varchar(64)"  remarks="流程模型的编号">
                <constraints nullable="true" />
            </column>
            <column name="description" type="varchar(255)" remarks="描述" >
                <constraints nullable="true" />
            </column>
            <column name="form_id" type="number" remarks="表单编号" >
                <constraints nullable="true" />
            </column>
            <column name="creator" type="varchar(64)" remarks="创建人" >
                <constraints nullable="true" />
            </column>
            <column name="create_time" type="date" remarks="创建时间" >
                <constraints nullable="true" />
            </column>
            <column name="updater" type="varchar(64)" remarks="更新人" >
                <constraints nullable="true" />
            </column>
            <column name="update_time" type="varchar(64)" remarks="更新时间" >
                <constraints nullable="true" />
            </column>
            <column name="tenant_id" type="varchar(64)" remarks="租户编号" >
                <constraints nullable="true" />
            </column>
        </createTable>
        <sql dbms="mysql" >ALTER TABLE `cscp_flow_process_def_ext` CONVERT TO CHARACTER SET UTF8;</sql>
    </changeSet>


    <changeSet id="FLOW-20220805-003" author="jshx">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cscp_flow_task_assign_rule"/>
            </not>
        </preConditions>
        <createTable tableName="cscp_flow_task_assign_rule" remarks="流程规则人员扩展表">
            <column name="id" type="number" remarks="编号">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="model_id" type="varchar(64)"  remarks="流程模型的编号">
                <constraints nullable="false" />
            </column>
            <column name="process_definition_id" type="varchar(100)"  remarks="流程定义的编号">
                <constraints nullable="false" />
            </column>
            <column name="task_definition_key" type="varchar(64)"  remarks="流程任务定义的 key">
                <constraints nullable="false" />
            </column>
            <column name="type" type="number" remarks="规则类型" >
                <constraints nullable="true" />
            </column>
            <column name="options" type="varchar(1024)" remarks="规则值，JSON 数组" >
                <constraints nullable="true" />
            </column>
            <column name="creator" type="varchar(64)" remarks="创建人" >
                <constraints nullable="true" />
            </column>
            <column name="create_time" type="date" remarks="创建时间" >
                <constraints nullable="true" />
            </column>
            <column name="updater" type="varchar(64)" remarks="更新人" >
                <constraints nullable="true" />
            </column>
            <column name="update_time" type="varchar(64)" remarks="更新时间" >
                <constraints nullable="true" />
            </column>
            <column name="tenant_id" type="varchar(64)" remarks="租户编号" >
                <constraints nullable="true" />
            </column>
        </createTable>
        <sql dbms="mysql" >ALTER TABLE `cscp_flow_process_def_ext` CONVERT TO CHARACTER SET UTF8;</sql>
    </changeSet>


    <changeSet id="FLOW-20220808-001" author="jshx">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cscp_operate_perm"/>
            </not>
        </preConditions>
        <createTable tableName="cscp_operate_perm" remarks="操作权限关联关系表">
            <column name="id" type="number" remarks="编号">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="task_definition_Key" type="varchar(64)"  remarks="任务标识">
                <constraints nullable="true" />
            </column>
            <column name="task_definition_name" type="varchar(64)"  remarks="任务名称">
                <constraints nullable="true" />
            </column>
            <column name="perms" type="varchar(64)" remarks="操作权限" >
                <constraints nullable="true" />
            </column>
            <column name="task_definition_flag" type="varchar(64)" remarks="流程标识" >
                <constraints nullable="true" />
            </column>
        </createTable>
        <sql dbms="mysql" >ALTER TABLE `cscp_operate_perm` CONVERT TO CHARACTER SET UTF8;</sql>
    </changeSet>
<!--    <changeSet id="FLOW-20220808-002" author="jshx" objectQuotingStrategy="QUOTE_ALL_OBJECTS">-->
<!--        <preConditions onFail="MARK_RAN">-->
<!--            <not>-->
<!--                <tableExists tableName="cscp_table_operation"/>-->
<!--            </not>-->
<!--        </preConditions>-->
<!--        <createTable tableName="cscp_table_operation" remarks="表单权限控制表">-->
<!--            <column name="id" type="number" remarks="编号">-->
<!--                <constraints nullable="false" primaryKey="true"/>-->
<!--            </column>-->
<!--            <column name="field_id" type="varchar(64)"  remarks="字段id">-->
<!--                <constraints nullable="true" />-->
<!--            </column>-->
<!--            <column name="form_id" type="varchar(64)"  remarks="表单id">-->
<!--                <constraints nullable="true" />-->
<!--            </column>-->
<!--            <column name="field_name" type="varchar(64)" remarks="表单名称" >-->
<!--                <constraints nullable="true" />-->
<!--            </column>-->
<!--            <column name="task_definition_Key" type="varchar(64)" remarks="任务标识" >-->
<!--                <constraints nullable="true" />-->
<!--            </column>-->
<!--            <column name="perm" type="varchar(1)" remarks="0可编辑1不可编辑" >-->
<!--                <constraints nullable="true" />-->
<!--            </column>-->
<!--            <column name="task_definition_flag" type="varchar(64)" remarks="流程标识" >-->
<!--                <constraints nullable="true" />-->
<!--            </column>-->
<!--        </createTable>-->
<!--        <sql dbms="mysql" >ALTER TABLE `cscp_table_operation` CONVERT TO CHARACTER SET UTF8;</sql>-->
<!--    </changeSet>-->
    <changeSet id="FLOW-20221031-001" author="jshx" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cscp_flow_field_perms"/>
            </not>
        </preConditions>
        <createTable tableName="cscp_flow_field_perms" remarks="字段权限控制表">
            <column name="id" type="number" remarks="主键id">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="field_perms" type="varchar(1000)"  remarks="字段权限">
                <constraints nullable="true" />
            </column>
            <column name="form_id" type="varchar(64)"  remarks="表单id">
                <constraints nullable="true" />
            </column>
            <column name="field_name" type="varchar(64)" remarks="表单名称" >
                <constraints nullable="true" />
            </column>
            <column name="task_definition_Key" type="varchar(64)" remarks="流程任务id" >
                <constraints nullable="true" />
            </column>
            <column name="task_definition_name" type="varchar(64)" remarks="流程标识" >
                <constraints nullable="true" />
            </column>
        </createTable>
        <sql dbms="mysql" >ALTER TABLE `cscp_flow_field_perms` CONVERT TO CHARACTER SET UTF8;</sql>
    </changeSet>

    <changeSet id="FLOW-20220808-003" author="jshx" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cscp_rd_turn_task"/>
            </not>
        </preConditions>
        <createTable tableName="cscp_rd_turn_task" remarks="传阅和转办任务存储表">
            <column name="id" type="number" remarks="编号">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="varchar(64)"  remarks="用户id">
                <constraints nullable="true" />
            </column>
            <column name="form_id" type="varchar(64)"  remarks="表单id">
                <constraints nullable="true" />
            </column>
            <column name="process_id" type="varchar(64)" remarks="流程id" >
                <constraints nullable="true" />
            </column>
            <column name="process_instid" type="varchar(64)" remarks="流程实例id" >
                <constraints nullable="true" />
            </column>
            <column name="process_name" type="varchar(255)" remarks="流程名称" >
                <constraints nullable="true" />
            </column>
            <column name="type" type="varchar(1)" remarks="1传阅2转办" >
                <constraints nullable="true" />
            </column>
            <column name="create_time" type="date" remarks="传阅或转办时间" >
                <constraints nullable="true" />
            </column>
            <column name="cur_assignee" type="number" remarks="当前处理人" >
                <constraints nullable="true" />
            </column>
            <column name="last_assignee" type="number" remarks="上一个处理人" >
                <constraints nullable="true" />
            </column>
        </createTable>
        <sql dbms="mysql" >ALTER TABLE `cscp_rd_turn_task` CONVERT TO CHARACTER SET UTF8;</sql>
    </changeSet>


    <!--  工作流角色-流程模板关系表  -->
    <changeSet id="FLOW-20220804-010" author="ctsi" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cscp_role_act"/>
            </not>
        </preConditions>
        <createTable tableName="cscp_role_act" remarks="工作流角色-流程模板关系表">
            <column name="id" type="number" remarks="ID">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="role_id" type="number"  remarks="角色id">
                <constraints nullable="true" />
            </column>
            <column name="proc_def_id" type="varchar(255)"  remarks="流程模板id">
                <constraints nullable="true" />
            </column>
            <column name="proc_def_name" type="varchar(255)"  remarks="流程模板名称">
                <constraints nullable="true" />
            </column>
            <column name="form_id" type="number"  remarks="表单id">
                <constraints nullable="true" />
            </column>
            <column  name="defined_id" type="varchar(255)" remarks="备用" >
                <constraints nullable="true" />
            </column>

        </createTable>
        <sql dbms="mysql" >ALTER TABLE `cscp_role_act` CONVERT TO CHARACTER SET UTF8;</sql>

        <rollback>
            <dropTable tableName="cscp_role_act"/>
        </rollback>
    </changeSet>

    <!--  工作流用户-流程模板关系表  -->
    <changeSet id="FLOW-20220804-011" author="ctsi" objectQuotingStrategy="QUOTE_ALL_OBJECTS" >
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cscp_user_act"/>
            </not>
        </preConditions>
        <createTable tableName="cscp_user_act" remarks="工作流用户-流程模板关系表">
            <column name="id" type="number" remarks="ID">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="number"  remarks="用户id">
                <constraints nullable="true" />
            </column>
            <column name="proc_def_id" type="varchar(255)"  remarks="流程模板id">
                <constraints nullable="true" />
            </column>
            <column name="proc_def_name" type="varchar(255)"  remarks="流程模板名称">
                <constraints nullable="true" />
            </column>
            <column name="form_id" type="number"  remarks="表单id">
                <constraints nullable="true" />
            </column>
            <column  name="defined_id" type="varchar(255)" remarks="备用" >
                <constraints nullable="true" />
            </column>
            <column name="iscollect" type="varchar(255)"  remarks="是否收藏">
                <constraints nullable="true" />
            </column>
            <column name="collect_time" type="date"  remarks="收藏时间">
                <constraints nullable="true" />
            </column>
            <column name="process_id" type="varchar(255)"  remarks="流程ID">
                <constraints nullable="true" />
            </column>
            <column  name="publish_time" type="date" remarks="发布时间" >
                <constraints nullable="true" />
            </column>

        </createTable>
        <sql dbms="mysql" >ALTER TABLE `cscp_user_act` CONVERT TO CHARACTER SET UTF8;</sql>

        <rollback>
            <dropTable tableName="cscp_user_act"/>
        </rollback>
    </changeSet>


    <changeSet id="FLOW-20220808-004" author="jshx">
        <sql>
            /*
            工作流菜单
            */
            INSERT INTO cscp_menus VALUES (1556534310647762945, 'workflow', 'ios-add-circle-outline', '流程编排', 'workflow', NULL, 'views/main/main.vue', 1531825660240404481, 'menu1', 'cscp.workFlow.bpmnEdit', 13);
            INSERT INTO cscp_menus VALUES (1556534445326864385, 'flowform', 'md-add-circle', '流程模型', '/flowform', NULL, 'views/workflow/flowform.vue', 1556534310647762945, 'menu2', 'cscp.workFlow.bpmnEdit', 3);
            INSERT INTO cscp_menus VALUES (1556534598771281922, 'modelEditor', 'ios-add-circle-outline', '模型设计器', '/modelEditor', NULL, 'views/workflow/modelEditor.vue', 1556534310647762945, 'non-menu', 'cscp.workFlow.bpmnEdit', 2);
            INSERT INTO cscp_menus VALUES (1556534679620685826, 'person', 'ios-analytics', '个人门户', '/person', NULL, 'views/workflow/person.vue', 1556534310647762945, 'menu2', 'cscp.workFlow.bpmnEdit', 4);
            INSERT INTO cscp_menus VALUES (1556534679620685827, 'launchprocess ', 'ios-add-circle-outline', '流程发起', '/launchprocess', NULL, 'views/workflow/approval/LaunchProcess.vue', 1556534310647762945, 'non-menu', NULL, 5);
            INSERT INTO cscp_menus VALUES (1565515795699085313, 'processStatistics', 'ios-easel-outline', '流程统计', '/processStatistics', NULL, 'views/workflow/processStatistics.vue', 1556534310647762945, 'menu2', NULL, 6);
            INSERT INTO cscp_menus VALUES (1567419391709896705, 'hotProcessAnalyse', 'ios-bonfire', '热门流程', '/hotProcessAnalyse', NULL, 'views/workflow/hotProcessAnalyse.vue', 1556534310647762945, 'menu2', NULL, 7);
            INSERT INTO cscp_menus VALUES ('1547757159401709569', 'db-manager', 'ios-paper', '数据表管理', '/db-manager', '*', 'views/lowcode/customize/components/db/dbManager.vue', '1556534310647762945', 'menu2', null, '1');
            INSERT INTO cscp_menus VALUES ('1531826724696039426', 'lowcode-programming', 'ios-train', '表单设计', '/lowcode-programming', '*', 'views/lowcode/customize/customizeVformManager.vue', '1556534310647762945', 'menu2', null, '2');
            INSERT INTO cscp_menus VALUES ('1541944780528390300', 'sub-lowcode-programming', 'ios-car', '低代码子表', '/sub-lowcode-programming', '*', 'views/lowcode/customize/components/subVformManager.vue', '1531826724696039426', 'non-menu', null, '1');

        </sql>
    </changeSet>

    <changeSet id="FLOW-20220808-005" author="jshx">
        <sql>
            /*
            工作流菜单角色关联
            */
            INSERT INTO cscp_role_menu VALUES (1556534310647762946, 1, 1556534310647762945);
            INSERT INTO cscp_role_menu VALUES (1556534445326864386, 1, 1556534445326864385);
            INSERT INTO cscp_role_menu VALUES (1556534598771281923, 1, 1556534598771281922);
            INSERT INTO cscp_role_menu VALUES (1556534679620685827, 1, 1556534679620685826);
            INSERT INTO cscp_role_menu VALUES (1556534679620685828, 1, 1556534679620685827);
            INSERT INTO cscp_role_menu VALUES (1565515796240150529, 1, 1565515795699085313);
            INSERT INTO cscp_role_menu VALUES (1567419391730868226, 1, 1567419391709896705);
            INSERT INTO cscp_role_menu VALUES (1547390521305260033, 1, 1547757159401709569);
            INSERT INTO cscp_role_menu VALUES (1531826724956086273, 1, 1531826724696039426);
            INSERT INTO cscp_role_menu VALUES (1541944780528390300, 1, 1541944780528390300);
        </sql>
    </changeSet>

    <changeSet id="FLOW-20221103-001" author="jshx">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cscp_flow_task_multi_rule"/>
            </not>
        </preConditions>
        <createTable tableName="cscp_flow_task_multi_rule" remarks="流程规则多实例策略表">
            <column name="id" type="number" remarks="编号">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="task_definition_key" type="varchar(100)"  remarks="流程任务定义的 key">
                <constraints nullable="true" />
            </column>
            <column name="task_multi" type="varchar(200)"  remarks="多实例策略">
                <constraints nullable="true" />
            </column>
            <column name="scheme"  type="number" remarks="比例或票数">
                <constraints nullable="true" />
            </column>
            <column name="creator" type="varchar(64)" remarks="创建人" >
                <constraints nullable="true" />
            </column>
            <column name="create_time" type="date" remarks="创建时间" >
                <constraints nullable="true" />
            </column>
            <column name="updater" type="varchar(64)" remarks="更新人" >
                <constraints nullable="true" />
            </column>
            <column name="update_time" type="date" remarks="更新时间" >
                <constraints nullable="true" />
            </column>
        </createTable>
        <sql dbms="mysql" >ALTER TABLE `cscp_flow_task_multi_rule` CONVERT TO CHARACTER SET UTF8;</sql>
    </changeSet>

    <changeSet id="FLOW-20221103-002" author="jshx">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="approve"/>
            </not>
        </preConditions>
        <createTable tableName="approve" remarks="申请表">
            <column name="id" type="number" remarks="编号">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="day" type="number"  >
                <constraints nullable="true" />
            </column>
            <column name="reason" type="varchar(255)"  >
                <constraints nullable="true" />
            </column>
            <column name="from_area" type="varchar(20)"  >
                <constraints nullable="true" />
            </column>
            <column name="to_area" type="varchar(20)"  >
                <constraints nullable="true" />
            </column>
            <column name="user_id" type="number"  >
                <constraints nullable="true" />
            </column>
            <column name="instance_id" type="varchar(100)"  >
                <constraints nullable="true" />
            </column>
        </createTable>
        <sql dbms="mysql" >ALTER TABLE `approve` CONVERT TO CHARACTER SET UTF8;</sql>
    </changeSet>

</databaseChangeLog>
